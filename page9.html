<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="keywords" content="" /> 
    <meta name="description" content="" />
    <title>Программирование - Электронный учебник</title>
    <link rel="stylesheet" href="css/normalize.css">
    <!-- <link rel="stylesheet" href="bootstrap-grid.min.css"> -->
    <link rel="stylesheet" href="css/style.css">
<script type="text/javascript" src="jwplayer/jwplayer.js"></script>
<meta name="generator" content="TurboSite 1.7.1" />

</head>

<body>

    <div class="container">

        <header>
            <a href="index.html" class="logo">
                <img class="logo__img" src="user-images/logo.png" alt="">
                <div class="logo__text">
                    <div class="logo__subname">
                        
    
                    
                    </div>
                </div>
            </a>
            
            <button class="btn" id="show-lists-mobile"></button>
            
            <div class="nav-container">
                <div class="burger" id="burger">
                    <span class="burger__icon"></span>
                </div>
    
                <nav id="nav">
                    <div class="menu-container">
                        <div class="close-container">
                            <span class="title-nav">Меню</span>
                            <span id="close-menu" class="close">✖</span>
                        </div>
                        <ul class="menu" id="menu">

                            

                        </ul>
                    </div>
                </nav>
            </div>
        </header>

        <aside class="aside">
            <div class="aside__container">

                <div class="aside__header">

                    <div class="aside__title-container">
                        <div class="aside__title"></div>
                        <div class="aside__close close" id="close-aside">✖</div>
                    </div>

                    <input class="input-text" id="filter" type="text" placeholder="">

                </div>

                <div class="aside__body">

                    <div id="list">
                        						
						

<h2 class="title">Искуственный интеллект</h2>
<p>
<ul>	<li><a href="page1.html">О курсе</a></li>	<li><a href="page17.html">Введение</a></li>	<li><a href="#">1. Отделы компании &quot;Альтернативное будущее&quot;</a>	<ul>		<li><a href="page5.html">1.1. Фундаментальные знания</a></li>	 	<li><a href="page6.html">1.2. Теоретическая информатика</a></li>		<li><a href="page7.html">1.3. Анализ и визуализация данных</a></li>		<li><a href="page8.html">1.4. Методы ИИ и проектирования разговорных интерфейсов</a></li>		<li><a href="page9.html">1.5. Программирование</a></li>		<li><a href="page10.html">1.6. Пасхалка</a></li>	</ul>	</li>	<li><a href="#">2. Отборочный этап. Первая попытка</a>	<ul>		<li><a href="page11.html">2.1. Знакомство со сферой Технологии и искусственный интеллект</a></li>		<li><a href="page12.html">2.2. Попытка 1. Задания</a></li>		<li><a href="page13.html">2.3. Попытка 2. Задания</a></li>	</ul>	</li>	<li><a href="#">3. Задания</a>	<ul>		<li><a href="page15.html">3.1. Общая формулировка задания</a></li>		<li><a href="page14.html">3.2. Разработка электронного личного секретаря</a></li>	</ul>	</li></ul></p>

						
                    </div>
					
                </div>

            </div>
        </aside>

        <main>
            <h1>

                Программирование
            
            </h1>
            
            <h3>Введение</h3>

<p>В этом отделе ответственный за стажировку - иностранный представитель компании Альтернативное Будущее - Tonyph. Tonyph отвечает за разработку умных чат-ботов.</p>

<p>Он не многословен, но подготовил для вас все необходимые инструкции, чтобы и вы попробовали себя в его роли.</p>

<p>Модуль dialogflow из google.cloud позволит релизовать дополнительные возможности, например:</p>

<ul>
	<li>использование набора данных в ответах намерений,</li>
	<li>создание кнопок в Telegram боте,</li>
	<li>добавление изображений в сообщения от бота и прочее.</li>
</ul>

<p>Для начала выберем среду для разработки кода на языке программирования&nbsp;<code>Python</code>. Мы рекомендуем вам использовать настольные версии IDE во избежание каких-либо ограничений и ошибок.</p>

<h4><a href="https://www.anaconda.com/products/distribution" rel="noopener noreferrer nofollow" target="_blank">Anaconda</a></h4>

<p>А именно - Spyder IDE.</p>

<p>Для запуска чат бота необходимо запускать&nbsp;<code>Anaconda Prompt</code>. Затем перейти через команду&nbsp;<code>cd</code>&nbsp;в каталог с файлом&nbsp;<code>`.py`</code>, в котором написан чат-бот и запустить через команду&nbsp;<code>python index.py</code>&nbsp;(index - уловное название файла.)</p>

<ul>
	<li><a href="https://pythonru.com/baza-znanij/kak-ustanovit-anaconda-na-windows" rel="noopener noreferrer nofollow" target="_blank">Инструкция по установке</a></li>
	<li><a href="https://pythonru.com/baza-znanij/nachalo-raboty-s-anaconda" rel="noopener noreferrer nofollow" target="_blank">Инструкция по работе</a></li>
</ul>

<h4><a href="https://www.jetbrains.com/pycharm/" rel="noopener noreferrer nofollow" target="_blank">PyCharm</a></h4>

<ul>
	<li><a href="https://py-charm.blogspot.com/2017/09/blog-post.html" rel="noopener noreferrer nofollow" target="_blank">Инструкция</a></li>
</ul>
<h3>Задача 1. Подключение Google CLI</h3>

<p>Ознакомьтесь с&nbsp;<a href="https://github.com/jezvgg/DialogflowPython#readme" rel="noopener noreferrer nofollow" target="_blank">инструкцией по ссылке</a>.</p>
<h3>Задача 2. Обращение к АПИ Dialogflow</h3>

<p>Код, для обращения к Dialogflow, который написал Tonyph был частично утерян. Скрипт позволяет обратиться к вашему агенту в DialogFlow и взаимодействовать с ним программно. Вводим некоторый запрос от пользователя, в результате получаем ответ от бота с указанием обрабатывающего интента.</p>

<p>Воспользуйтесь&nbsp;<a href="https://github.com/jezvgg/DialogFlowPython/blob/main/simple%20example/main.py" rel="noopener noreferrer nofollow" target="_blank">примером</a>, чтобы помочь&nbsp; разработчику отдела заполнить пропуски в коде. В качестве project-id используйте&nbsp;<code>project-id</code>, а session-id используйте&nbsp;<code>session-id</code>. Текст в пропуски вводите без пробелов и явно указывайте названия параметров.</p>

<pre>
<code>from google.cloud import dialogflow
test_text = input()

session_client = [_____]	
session        = [_____]
text_input     = [_____]=language) 
query_input    = [_____]
response       = [_____](   
	request={&quot;session&quot;: session, &quot;query_input&quot;: query_input}
	)

print(&quot;Текст запроса: {}&quot;.format(response.query_result.query_text))
print(
	&quot;Обрабатывающий интент: {}&quot;.format(
    	response.query_result.intent.display_name
	)
 )
print(&quot;Текст ответа: {}\n&quot;.format(response.query_result.fulfillment_text))</code></pre>
<h3>Задача 3. Работа с телеграмм АПИ</h3>

<p>Конечно, Dialogflow имеет возможность интегрировать в телеграмм, без привлечения к программированию. Но для сложных задач, не всегда получается обходиться NoCode-решениями, поэтому важно уметь самим подключать Dialogflow к вашему телеграмм боту.</p>

<p>Допустим, что вы уже написали функцию&nbsp;<code>response</code>, которая принимает текст, отправляет вашему агенту в Dialogflow и отправляет вам его ответ. Заполните пропуски кода для создания чат-бота в телеграмм с использованием вашей функции&nbsp;<code>response</code>, которая возвращает ответ от Dialogflow.</p>

<p>Примеры&nbsp;<a href="https://github.com/jezvgg/DialogFlowPython/tree/main" rel="noopener noreferrer nofollow" target="_blank">более сложных ботов</a>, в которых может это понадобиться.</p>

<pre>
<code>from aiogram import Bot, Dispatcher, executor
bot = Bot(token=settings[&#39;bot-token&#39;])
dp = [_____]
[_____]
[_____] def start(message):
	text = message.text
	await message.answer([_____])
if __name__ == &#39;__main__&#39;:
	executor.start_polling(dp)</code></pre>

        <h3>Динамический ответ бота</h3>

<p>Когда пользователь отвечал боту о любимом жанре и предпочтениях страны производства, бот сообщал незначительные фразы: Спасибо я запомнил! или Круто!</p>

<p>Настроим динамический ответ бота, который бы рекомендовал фильмы по жанру.</p>

<h4>Настройка Dialogflow</h4>

<p>Для этого в платформе Dialogflow:</p>

<ul>
	<li>Проверим сущность&nbsp;<code>Genres</code>, добавим необходимые в соответствии со&nbsp;<a href="https://yupest2.pythonanywhere.com/api/v1.0/movies/genres" rel="noopener noreferrer nofollow" target="_blank">списком жанров по API</a>.</li>
	<li>В интенте&nbsp;<code>Жанр</code>&nbsp;добавим тренировочные фразы для всех заданных жанров. Если в тренировочных фразах интент определился неверно или не определился вовсе, его можно назначить, кликнув на&nbsp;<code>Entity</code>:<br />
	<img alt="" src="https://ucarecdn.com/4258f793-b7c1-4840-aee2-330af8d1e78f/" style="border:0px; height:auto; vertical-align:middle; width:501px" /></li>
	<li>В разделе Action and parameters замените&nbsp;<code>Parameter name</code>&nbsp;на&nbsp;<code>genre</code>&nbsp;или такой же, как название параметра в коде<br />
	<img alt="" src="https://ucarecdn.com/0e99d3c9-644a-40b5-b00e-89ee83f94054/" style="border:0px; height:auto; vertical-align:middle; width:556px" /></li>
	<li>В разделе Fulfillment включим первый таб:<br />
	<img alt="" src="https://ucarecdn.com/0e6c39e0-4b3a-4f8b-9ac6-79c1cd36af90/" style="border:0px; height:auto; vertical-align:middle; width:488px" /></li>
	<li>*Для тестирования кода ниже вы можете убрать из приветственного интента возможный ответ бота о стране и оставить только о жанре. А также при желании заменить длину контекста&nbsp;<code>flag</code>, чтобы интент&nbsp;<code>Жанр</code>&nbsp;существовал более 1 раза.</li>
</ul>

<h4>Динамический ответ бота</h4>

<p>Будем пользоваться сервисом&nbsp;<a href="https://replit.com/languages/python3%C2%A0" rel="noopener noreferrer nofollow" target="_blank">Replit</a>. При регистрации в данной платформе можно воспользоваться учетной записью Google.</p>

<blockquote>
<p><a href="https://techrocks.ru/2021/11/15/replit-beginners-guide/%C2%A0" rel="noopener noreferrer nofollow" target="_blank">Подробная инструкция о том, как пользоваться платформой</a></p>
</blockquote>

<p>Создадим проект&nbsp;<code>Create Repl</code>&nbsp;в верхнем левом углу.</p>

<p><img alt="" src="https://ucarecdn.com/580a6511-de28-4880-9516-1354f0f0adef/" style="border:0px; height:auto; vertical-align:middle; width:166px" /></p>

<p>Выберем шаблон&nbsp;<code>Flask&nbsp;</code>- это библиотека для создания веб-приложения на Python. Назовем проект&nbsp;<code>test-webhook</code>.</p>

<p><img alt="" src="https://ucarecdn.com/185dabbd-a9f4-48bd-a288-0c574c5a2170/" style="border:0px; height:auto; vertical-align:middle; width:419px" /></p>

<p>Допишите шаблон кода и нажмите&nbsp;<code>Start</code>:&nbsp;</p>

<pre>
<code>from flask import Flask, request, jsonify, make_response
import requests
import random

app = Flask(__name__)
# настройка поддержки кириллицы
app.config[&#39;JSON_AS_ASCII&#39;] = False

# маршрут по умолчанию
@app.route(&#39;/&#39;)
def index():
    return &#39;Hello from Flask!&#39;

def get_film(genre):
  # список фильмов по жанру
  films = requests.get(f&#39;https://yupest2.pythonanywhere.com/api/v1.0/movies/?genre={genre}&#39;).json()[&#39;records&#39;]

  # случайный фильм в диапазоне от нулевого до последнего из списка
  film = films[random.randint(0, len(films)-1)]

  # строка ответа бота с рекомендацией фильма
  return &#39;{} в жанре {}, сделан в стране: {} с рейтингом: {}&#39;.format(film[&#39;Название&#39;], film[&#39;Жанр&#39;], film[&#39;Страна&#39;], film[&#39;Средняя оценка&#39;])

def get_result():
  # извлечение параметра
  req = request.get_json(force=True)
  result = req.get(&quot;queryResult&quot;)
  parameters = result.get(&quot;parameters&quot;)
  # название параметра в соответствии с названием параметра сущности в интенте Genres
  # здесь можно задать переменные для каждого параметра, если их несколько
  genre = parameters.get(&quot;genre&quot;)

  # если параметр задан, вернем случайный фильм
  if genre:
    return {&#39;fulfillmentText&#39;: get_film(genre)}

# маршрут webhook
@app.route(&#39;/webhook&#39;, methods = [&#39;GET&#39;, &#39;POST&#39;])
def webhook():
  return make_response(jsonify(get_result()))

app.run(host=&#39;0.0.0.0&#39;, port=5000)
</code></pre>

<h4>Настройка Webhook в Dialogflow</h4>

<p>Скопируем ссылку в проекте&nbsp;<code>Replit</code></p>

<p><img alt="" src="https://ucarecdn.com/b672e90e-2e97-48cd-aaaa-7f72913d8acd/" style="border:0px; height:auto; vertical-align:middle; width:2087px" /></p>

<p>Скопированная ссылка необходима при настройке&nbsp;<code>Webhook</code>&nbsp;в разделе&nbsp;<code>Fulfillment</code>&nbsp;в Dialogflow. Допишем к ней&nbsp;<code>/webhook</code>&nbsp;и не забудьте сохраниться (<code>Save</code>&nbsp;внизу страницы)</p>

<p><img alt="" src="https://ucarecdn.com/0f9e88f9-d2b3-4eba-8d9d-5b8319a65109/" style="border:0px; height:auto; vertical-align:middle; width:827px" /></p>

<p>&nbsp;Приступим к тестированию:</p>

<p><img alt="" src="https://ucarecdn.com/7592384f-ee92-4d1a-b46a-2a0055d0de56/" style="border:0px; float:left; height:auto; vertical-align:middle; width:303px" /><img alt="" src="https://ucarecdn.com/457d2777-e6e0-4c38-9735-a1349ccdc217/" style="border:0px; height:auto; vertical-align:middle; width:323px" /></p>

<h4>Реализуем интеграцию в Телеграм</h4>

<p>Чтобы создать чат-бот Telegram, потребуется бот&nbsp;</p>

<p><a href="https://t.me/BotFather" rel="noopener noreferrer nofollow" target="_blank">@BotFather</a></p>

<ol>
	<li>﻿Чтобы запустить бот, нужно нажать кнопку&nbsp;/start</li>
	<li>Выбираем или пишем команду&nbsp;/newbot</li>
	<li>Задать любое имя для вашего бота.&nbsp;</li>
	<li>Задать username вашему боту - уникальное имя, которое нельзя будет менять, и которое обязательно должно оканчиваться на &quot;bot&quot;. Причем регистр букв не имеет значения. Может быть и &quot;BOT&quot;, и &quot;bot&quot;, и&nbsp;&quot;Bot&quot; и даже&nbsp;&quot;boT&quot;. Длина юзернейма должна быть от 5 до 32 символов. Можно использовать латинские буквы, цифры и подчеркивания.&nbsp;</li>
	<li>После успешного прохождения этапов, BotFather отправит вам токен и ссылку на документацию.</li>
</ol>

<p><img alt="" src="https://ucarecdn.com/d72115d2-dc20-4273-99c9-b377c77259e7/" style="border:0px; height:auto; vertical-align:middle; width:589px" /></p>

<p>В Dialogflow перейдем на вкладку&nbsp;<code>Integration</code>, выберем&nbsp;<code>Telegram</code>&nbsp;и вставим свой&nbsp;<code>token</code>. Нажмем на&nbsp;<code>start</code>.</p>

<p><img alt="" src="https://ucarecdn.com/99114c27-ec77-45b4-9db6-dba7ad2784bb/" style="border:0px; height:auto; vertical-align:middle; width:730px" /></p>

<p>Из&nbsp;<code>@botFather</code>&nbsp;перейдите в созданный чат-бот и запустите. Начните тестирование:</p>

<p><img alt="" src="https://ucarecdn.com/a2b0129a-903e-4f61-b9e0-eb40edfb1d01/" style="border:0px; height:auto; vertical-align:middle; width:667px" /></p>


<h3>Задача 4. Рекомендация фильма по стране</h3>

<p>Изучив материал прошлого шага найдите ошибки во фрагменте кода функций, которые формируют ответ бота. Текущий скрипт необходим для настройки динамического ответа бота не только по жанру, но и по стране. Попробуйте реализовать данный функционал в боте.</p>

<pre>
<code>def get_film(key, value):
  films = requests.get(f&#39;https://yupest2.pythonanywhere.com/api/v1.0/movies/{key}={value}&#39;).json()[&#39;records&#39;]
  film = films[random.randint(0, len(films))]
  return &#39;{} в жанре {}, сделан в стране: {} с рейтингом: {}&#39;.format(film[&#39;Названия&#39;], film[&#39;Жанр&#39;], film[&#39;Страна&#39;], film[&#39;Средняя оценка&#39;])

def get_result():
  # извлечение параметра
  req = request.get_json(force=True)
  result = req.get(&quot;queryResult&quot;)
  parameters = result.get(&quot;parameters&quot;)

  genre = parameters.get(&quot;genre&quot;)
  country = parameters.get(&quot;country&quot;)
  if genre:
    return {&#39;fulfillmentText&#39;: get_film(&#39;genre&#39;, genre)}
  if country:
    return {&#39;fulfillmentText&#39;: get_film(&#39;country&#39;, genre)}</code></pre>


            
			<a class="none" href="http://brullworfel.ru/turbosite">TurboSite</a>
			
        </main>

		

    </div>

	<style>
		.galleria{height:px; margin-bottom:20px}
     </style>
    <script src="js/galleria/jquery-3.5.1.min.js"></script>
    <script src="js/galleria/galleria.min.js"></script>
    <script src="js/script.js"></script>
	
</body>
</html>
